<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kişisel Merkez</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: #e0e0e0; min-height: 100vh; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 480px; background-color: #f8f8f8; min-height: 100vh; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); padding-bottom: 90px; overflow-x: hidden; }

        /* --- Üst Turuncu Alan --- */
        .top-header { background: linear-gradient(180deg, #fb7701 0%, #ff9030 100%); padding: 20px; padding-bottom: 80px; color: white; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; }
        .header-nav { display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: bold; margin-bottom: 20px; }
        .user-profile { display: flex; align-items: center; gap: 15px; }
        .avatar-circle { width: 60px; height: 60px; background-color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #fb7701; font-size: 30px; }
        .user-details h2 { font-size: 20px; margin-bottom: 5px; }
        .vip-badge { background-color: #ffcea0; color: #d35400; padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: bold; }
        .info-bar { display: flex; justify-content: space-between; margin-top: 15px; font-size: 14px; color: rgba(255,255,255,0.9); }
        .copy-icon { margin-left: 5px; cursor: pointer; }

        /* --- Bakiye Kartı --- */
        .balance-card { background-color: white; margin: -60px 15px 15px 15px; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; }
        .balance-header { display: flex; justify-content: space-between; color: #666; font-size: 14px; margin-bottom: 10px; }
        .balance-header i { cursor: pointer; padding: 5px; }
        .main-balance { font-size: 28px; font-weight: bold; color: #000; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .sub-balances { display: flex; justify-content: space-between; }
        .sub-item h4 { font-size: 12px; color: #999; font-weight: normal; margin-bottom: 5px; }
        .sub-item span { font-weight: bold; color: #333; font-size: 16px; }

        /* --- Menü Listesi --- */
        .menu-list { background-color: white; margin: 0 15px; border-radius: 15px; overflow: hidden; }
        .menu-item { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: 0.2s; }
        .menu-item:active { background-color: #f9f9f9; }
        .menu-left { display: flex; align-items: center; gap: 15px; color: #333; font-size: 15px; }
        .menu-icon { width: 20px; text-align: center; }
        .icon-blue { color: #4a90e2; }
        .icon-green { color: #2ecc71; }
        .icon-purple { color: #9b59b6; }
        .icon-orange { color: #e67e22; }
        .icon-cyan { color: #00bcd4; }
        .icon-red { color: #e74c3c; }
        .icon-yellow { color: #f1c40f; }
        .arrow-right { color: #ccc; font-size: 14px; }

        .logout-container { padding: 20px 15px; }
        .logout-btn { width: 100%; background-color: #ef4444; color: white; border: none; padding: 15px; border-radius: 30px; font-size: 16px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }

        /* --- ALT NAVİGASYON --- */
        .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; height: 70px; background-color: white; display: flex; justify-content: space-around; align-items: flex-end; padding-bottom: 10px; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 999; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; text-decoration: none; color: #999; font-size: 11px; width: 20%; cursor: pointer; margin-bottom: 5px; }
        .nav-item i { font-size: 22px; margin-bottom: 4px; }
        .nav-item.active { color: #fb7701; }
        .nav-center-wrapper { position: relative; width: 20%; display: flex; justify-content: center; }
        .nav-center-btn { width: 55px; height: 55px; background: linear-gradient(135deg, #fb7701 0%, #ff9030 100%); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: white; font-size: 24px; position: absolute; bottom: 10px; box-shadow: 0 4px 10px rgba(251, 119, 1, 0.4); cursor: pointer; text-decoration: none; }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-box { background-color: white; padding: 30px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; }
        .modal-close-btn { background-color: #fb7701; color: white; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="top-header">
            <div class="header-nav">
                <span>Kişisel Merkez</span>
                <i class="fa-solid fa-flag" style="color: red;"></i>
            </div>
            <div class="user-profile">
                <div class="avatar-circle">
                    <i class="fa-regular fa-user"></i>
                </div>
                <div class="user-details">
                    <h2 id="userPhoneDisplay">Yükleniyor...</h2> 
                    <span class="vip-badge" id="userVipDisplay">VIP--</span>
                </div>
            </div>
            <div class="info-bar">
                <div>
                    Davet Kodu: <span id="inviteCode">--</span> 
                    <i class="fa-regular fa-copy copy-icon" onclick="copyInviteCode()"></i>
                </div>
                <div><i class="fa-regular fa-star"></i> Kredi notu: 100</div>
            </div>
        </div>

        <div class="balance-card">
            <div class="balance-header">
                <span>Hesap bakiyesi</span>
                <i class="fa-regular fa-eye" id="eyeIcon" onclick="toggleBalance()"></i>
            </div>
            <div class="main-balance" id="mainBalance">TRY 0.00</div>
            
            <div class="sub-balances">
                <div class="sub-item">
                    <h4>Kalan bakiye</h4>
                    <span class="sub-val" id="subBalance1">TRY 0.00</span>
                </div>
                <div class="sub-item">
                    <h4>Dondurulmuş miktar</h4>
                    <span class="sub-val" id="subBalance2">TRY 0.00</span>
                </div>
            </div>
        </div>

        <div class="menu-list">
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-wallet menu-icon icon-blue"></i><span>Geri çekilmek</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-users menu-icon icon-green"></i><span>Ekip raporları</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-clock-rotate-left menu-icon icon-purple"></i><span>Para çekme kaydı</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-file-invoice menu-icon icon-orange"></i><span>Hesap değişiklik kayıtları</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-address-card menu-icon icon-cyan"></i><span>Para çekme bilgileri</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-solid fa-lock menu-icon icon-red"></i><span>Şifre değiştir</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
            <div class="menu-item" onclick="showContactModal()">
                <div class="menu-left"><i class="fa-regular fa-bell menu-icon icon-yellow"></i><span>Duyuru</span></div>
                <i class="fa-solid fa-chevron-right arrow-right"></i>
            </div>
        </div>

        <div class="logout-container">
            <button class="logout-btn" onclick="logout()">
                <i class="fa-solid fa-arrow-right-from-bracket"></i> Oturumu Kapat
            </button>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="home.html" class="nav-item"> <i class="fa-solid fa-house"></i> <span>Ön Sayfa</span> </a>
        <a href="jobs.html" class="nav-item"> <i class="fa-regular fa-heart"></i> <span>İş</span> </a>
        <div class="nav-center-wrapper">
            <a href="orders.html" class="nav-center-btn"><i class="fa-solid fa-bolt"></i></a>
        </div>
        <a href="orders.html" class="nav-item"> <i class="fa-regular fa-file-lines"></i> <span>Emir</span> </a>
        <a href="dashboard.html" class="nav-item active"> <i class="fa-regular fa-face-smile"></i> <span>Bana ait</span> </a>
    </div>

    <div class="modal-overlay" id="contactModal">
        <div class="modal-box">
            <i class="fa-solid fa-headset" style="font-size: 40px; color: #fb7701; margin-bottom: 15px;"></i>
            <div style="margin-bottom: 20px;">Bu işlem için yetkili ile iletişime geçilmeli.</div>
            <button class="modal-close-btn" onclick="closeContactModal()">Tamam</button>
        </div>
    </div>

    <script>
        const currentUserPhone = localStorage.getItem('currentUserPhone');
        if (!currentUserPhone) { window.location.href = "login.html"; }

        let realBalance = 0.00;
        let frozenBalance = 0.00;
        let isBalanceHidden = false;

        async function fetchUserData() {
            try {
                const response = await fetch('/get-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: currentUserPhone })
                });

                const data = await response.json();

                if (data.success) {
                    realBalance = parseFloat(data.user.balance) || 0;
                    frozenBalance = parseFloat(data.user.frozenBalance) || 0;

                    // Telefon Maskeleme
                    const p = data.user.phone;
                    const maskedPhone = p.substring(0, 3) + "****" + p.substring(p.length - 4);
                    document.getElementById('userPhoneDisplay').innerText = maskedPhone;

                    // VIP Seviyesi
                    document.getElementById('userVipDisplay').innerText = "VIP" + data.user.vipLevel;

                    updateBalanceUI();

                    // LocalStorage Güncelleme
                    localStorage.setItem('balance', realBalance);
                    localStorage.setItem('frozenBalance', frozenBalance);
                    localStorage.setItem('vipLevel', data.user.vipLevel);
                }
            } catch (error) { console.error("Veri çekilemedi:", error); }
        }

        function updateBalanceUI() {
            const mainEl = document.getElementById('mainBalance');
            const subEl1 = document.getElementById('subBalance1');
            const subEl2 = document.getElementById('subBalance2');
            
            if (isBalanceHidden) {
                mainEl.innerText = "****";
                subEl1.innerText = "****";
                subEl2.innerText = "****";
            } else {
                const total = realBalance + frozenBalance;
                mainEl.innerText = "TRY " + total.toFixed(2);
                subEl1.innerText = "TRY " + realBalance.toFixed(2);
                subEl2.innerText = "TRY " + frozenBalance.toFixed(2);
            }
        }

        function toggleBalance() {
            isBalanceHidden = !isBalanceHidden;
            const icon = document.getElementById('eyeIcon');
            icon.className = isBalanceHidden ? 'fa-regular fa-eye-slash' : 'fa-regular fa-eye';
            updateBalanceUI();
        }

        window.onload = function() {
            fetchUserData();
            let savedInvite = localStorage.getItem('myInviteCode');
            if(!savedInvite) {
                savedInvite = 'T' + Math.random().toString(36).substr(2, 6).toUpperCase();
                localStorage.setItem('myInviteCode', savedInvite);
            }
            document.getElementById('inviteCode').innerText = savedInvite;
        };

        function copyInviteCode() {
            const code = document.getElementById('inviteCode').innerText;
            navigator.clipboard.writeText(code).then(() => alert("Davet kodu kopyalandı!"));
        }

        function showContactModal() { document.getElementById('contactModal').style.display = 'flex'; }
        function closeContactModal() { document.getElementById('contactModal').style.display = 'none'; }
        
        function logout() { 
            if(confirm("Çıkış yapmak istediğinize emin misiniz?")) {
                localStorage.clear();
                window.location.href = "login.html"; 
            }
        }
    </script>
</body>
</html>